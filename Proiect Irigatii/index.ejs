<!doctype html>
<html ng-app>
<head>
<meta charset="utf-8">
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<tilte style="text-shadow: black; font-size: large; color:white; border-left: 10px;">Sistem de irigatie</title><br>

<base href="/">
<script type="text/javascript" src="/socket.io/socket.io.js"></script> 
<!--The above library(/socket.io/socket.io.js) will be generated by socket.io module of server -->
<script type="text/javascript" src="http://code.jquery.com/jquery-1.10.2.min.js"></script>

<link  href="/clientPage.css" rel="stylesheet" type="text/css" >
<link rel="stylesheet" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<!-- Latest compiled JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>



</head>
<body background="/bg.jpg" >

<br>

<button type="button" id="realTimeMap" onclick="querDB();">Query Data Base</button>
<div id="map" style="height: 400px; width: 100%;  "></div>
<br>

<div>
 Locatie: <input type="text" id="locatieBotanic"> Umiditate: <input type="text" id="umiditateBotanic"> Stare pompa: <input type="text" id="stPompaBotanic">
 <br>
 Locatie: <input type="text" id="locatieStadion"> Umiditate: <input type="text" id="umiditateStadion"> Stare pompa: <input type="text" id="stPompaStadion"> <br>
 Locatie: <input type="text" id="locatieZoo"> Umiditate: <input type="text" id="umiditateZoo"> Stare pompa: <input type="text" id="stPompaZoo"> <br>
 Locatie: <input type="text" id="locatieCopiilor"> Umiditate: <input type="text" id="umiditateCopiilor"> Stare pompa: <input type="text" id="stPompaCopiilor"> <br>
 Locatie: <input type="text" id="locatieMaria"> Umiditate: <input type="text" id="umiditateMaria"> Stare pompa: <input type="text" id="stPompaMaria"> <br>
 Locatie: <input type="text" id="locatieCivic"> Umiditate: <input type="text" id="umiditateCivic"> Stare pompa: <input type="text" id="stPompaCivic">  <br>
</div>


 <script>

var umidBot;

var map;

var citymap = {
        stadion: {
          center: {lat: 45.740428829824396, lng: 21.244258879451085},
          aria: 39190,
            },
        botanic: {
          center: {lat: 45.76019136083797, lng: 21.22487902612193},
          aria: 87000,
          },
        zoo: {
          center: {lat: 45.78129372200387, lng: 21.267582178552402},
          aria: 60000,
          },
        copiilor: {
          center: {lat: 45.751949643280774, lng: 21.236178875078625},
          aria: 45400,
          },
        maria: {
        center: {lat: 45.75556653392066, lng: 21.242571830553064},
          aria:  41100,
          },

        civic: {
        center: {lat: 45.75407610446289, lng: 21.231025457382206},
          aria: 49000,
          }


      };

        
          

  var socket = io.connect("/");  
  socket.emit("connection", "Client is connected!");     /*Initializing the connection with the server via websockets */


              socket.on("message",function(data){  
                     var coordonates;       
                    console.log("Rezutate: " + data.locatie + " "+ data.umiditate +" "+ data.starepompa);
                    if(data.locatie=="stadion")
                    {
                        document.getElementById("locatieStadion").value=data.locatie;
                        document.getElementById("umiditateStadion").value=data.umiditate;
                        document.getElementById("stPompaStadion").value=data.starepompa;

                    }
                   
                   if(data.locatie=="botanic")
                    {
                     //coordonates=citymap.botanic.center;
                        document.getElementById("locatieBotanic").value=data.locatie;
                        document.getElementById("umiditateBotanic").value=data.umiditate;
                        document.getElementById("stPompaBotanic").value=data.starepompa;
                  
                    }
                    
                    if(data.locatie=="zoo")
                    {
                        document.getElementById("locatieZoo").value=data.locatie;
                        document.getElementById("umiditateZoo").value=data.umiditate;
                        document.getElementById("stPompaZoo").value=data.starepompa;
                    }
                    
                    if(data.locatie=="maria")
                    {
                       document.getElementById("locatieMaria").value=data.locatie;
                        document.getElementById("umiditateMaria").value=data.umiditate;
                        document.getElementById("stPompaMaria").value=data.starepompa;
                    }
                    
                    if(data.locatie=="copiilor")
                    {
                        document.getElementById("locatieCopiilor").value=data.locatie;
                        document.getElementById("umiditateCopiilor").value=data.umiditate;
                        document.getElementById("stPompaCopiilor").value=data.starepompa;
                    }
                   
                    if(data.locatie=="civic")
                    {
                       document.getElementById("locatieCivic").value=data.locatie;
                        document.getElementById("umiditateCivic").value=data.umiditate;
                        document.getElementById("stPompaCivic").value=data.starepompa;
                    }

                    initMap();
                 
});

 


  function initMap(){
var myLatlng = new google.maps.LatLng(45.75372,21.22571);
var mapOptions = {
  zoom: 12,
  center: myLatlng
}
var map = new google.maps.Map(document.getElementById("map"), mapOptions);

 for (var place in citymap) {
  
          // Add the circle for this city to the map.
          

            if(citymap[place].aria==87000){
              var color;
              if(document.getElementById("stPompaBotanic").value=="oprita")
              {
                 color='#FF0000';
              }
              else if(document.getElementById("stPompaBotanic").value=="pornita")
              {
                color='#00cc00';
              }
            var placeCircle = new google.maps.Circle({
            strokeColor: color,
            strokeOpacity: 0.8,
            strokeWeight: 2,
            fillColor: color,  //rosu
            fillOpacity: 0.35,
            map: map,
            center: citymap[place].center,
            radius: Math.sqrt(citymap[place].aria)
          });

             var marker = new google.maps.Marker({
              position: citymap[place].center,
              map: map,
              title: "Umiditate: "+ document.getElementById("umiditateBotanic").value
            });
            marker.addListener('click', function() {
              infowindow.open(map, marker);
            });

         }

         else if(citymap[place].aria==39190){
         var color;
              if(document.getElementById("stPompaStadion").value=="oprita")
              {
                 color='#FF0000';
              }
              else if(document.getElementById("stPompaStadion").value=="pornita")
              {
                color='#00cc00';
              }
            var placeCircle = new google.maps.Circle({
            strokeColor: color,
            strokeOpacity: 0.8,
            strokeWeight: 2,
            fillColor: color,  //rosu
            fillOpacity: 0.35,
            map: map,
            center: citymap[place].center,
            radius: Math.sqrt(citymap[place].aria)
          });

            var marker = new google.maps.Marker({
              position: citymap[place].center,
              map: map,
              title: "Umiditate: "+ document.getElementById("umiditateStadion").value
            });
            marker.addListener('click', function() {
              infowindow.open(map, marker);
            });

          }

          else if(citymap[place].aria==60000){
          var color;
              if(document.getElementById("stPompaZoo").value=="oprita")
              {
                 color='#FF0000';
              }
              else if(document.getElementById("stPompaZoo").value=="pornita")
              {
                color='#00cc00';
              }
            var placeCircle = new google.maps.Circle({
            strokeColor: color,
            strokeOpacity: 0.8,
            strokeWeight: 2,
            fillColor: color,  //rosu
            fillOpacity: 0.35,
            map: map,
            center: citymap[place].center,
            radius: Math.sqrt(citymap[place].aria)
          });

            var marker = new google.maps.Marker({
              position: citymap[place].center,
              map: map,
              title: "Umiditate: "+ document.getElementById("umiditateZoo").value
            });
            marker.addListener('click', function() {
              infowindow.open(map, marker);
            });

          }


          else
          if(citymap[place].aria==45400){
          var color;
              if(document.getElementById("stPompaCopiilor").value=="oprita")
              {
                 color='#FF0000';
              }
              else if(document.getElementById("stPompaCopiilor").value=="pornita")
              {
                color='#00cc00';
              }
            var placeCircle = new google.maps.Circle({
            strokeColor: color,
            strokeOpacity: 0.8,
            strokeWeight: 2,
            fillColor: color,  //rosu
            fillOpacity: 0.35,
            map: map,
            center: citymap[place].center,
            radius: Math.sqrt(citymap[place].aria)
          });

            var marker = new google.maps.Marker({
              position: citymap[place].center,
              map: map,
              title: "Umiditate: "+ document.getElementById("umiditateCopiilor").value
            });
            marker.addListener('click', function() {
              infowindow.open(map, marker);
            });

          }

          else
          if(citymap[place].aria==41100){
             var color;
          var color;
              if(document.getElementById("stPompaMaria").value=="oprita")
              {
                 color='#FF0000';
              }
              else if(document.getElementById("stPompaMaria").value=="pornita")
              {
                color='#00cc00';
              }
            var placeCircle = new google.maps.Circle({
            strokeColor: color,
            strokeOpacity: 0.8,
            strokeWeight: 2,
            fillColor: color,  //rosu
            fillOpacity: 0.35,
            map: map,
            center: citymap[place].center,
            radius: Math.sqrt(citymap[place].aria)
          });

            var marker = new google.maps.Marker({
              position: citymap[place].center,
              map: map,
              title: "Umiditate: "+ document.getElementById("umiditateMaria").value
            });
            marker.addListener('click', function() {
              infowindow.open(map, marker);
            });

          }

          else
          if(citymap[place].aria==49000){
          var color;
              if(document.getElementById("stPompaCivic").value=="oprita")
              {
                 color='#FF0000';
              }
              else if(document.getElementById("stPompaCivic").value=="pornita")
              {
                color='#00cc00';
              }
            var placeCircle = new google.maps.Circle({
            strokeColor: color,
            strokeOpacity: 0.8,
            strokeWeight: 2,
            fillColor: color,  //rosu
            fillOpacity: 0.35,
            map: map,
            center: citymap[place].center,
            radius: Math.sqrt(citymap[place].aria)
          });

            var marker = new google.maps.Marker({
              position: citymap[place].center,
              map: map,
              title: "Umiditate: "+ document.getElementById("umiditateCivic").value
            });
            marker.addListener('click', function() {
              infowindow.open(map, marker);
            });

          }



       }
}


 



function querDB()
{
  console.log("query db");
           socket.emit("querydb", "Query database");
                  
  }


  function detectBrowser() {
  var useragent = navigator.userAgent;
  var mapdiv = document.getElementById("map");

  if (useragent.indexOf('iPhone') != -1 || useragent.indexOf('Android') != -1 ) {
    mapdiv.style.width = '100%';
    mapdiv.style.height = '100%';
  } else {
    mapdiv.style.width = '600px';
    mapdiv.style.height = '800px';
  }
}





// google.maps.event.addDomListener(window, 'load', initMap);

 function sleep(milliseconds) {
  var start = new Date().getTime();
  for (var i = 0; i < 1e7; i++) {
    if ((new Date().getTime() - start) > milliseconds){
      break;
    }
  }
}

</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDMwQDCgE-rLGZb11J_Kp2fij0VoVGtIpM&callback=initMap"
    async defer></script>
</body>
</html>
